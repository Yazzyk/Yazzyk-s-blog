<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yazzyk&#39;s Blog</title>
  <meta name="author" content="Yazzyk" />
  
  <meta name="description" content="环境搭建 前往ngrok下载指定客户端到本地 注册并登陆,开通一个隧道 到隧道管理可编辑自定义域名,复制隧道id 通过客户端启动隧道即可,以MacOS为例,在下载的客户端目录下,终端输入 1 ./sunny clientid 隧道id 文档 输入" />
  
  <meta name="keywords" content="">
  <meta name="baidu-site-verification" content="code-TtzfDaB45q" />
  <meta name="google-site-verification" content="kAjz9Ic_7Hir1rNUQtXSxTydJTryAv8JMelb2Qvnges" />
  <link rel="shortcut icon" href="https://shroot.dev/img/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://shroot.dev/css/white.css">
  
  
  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.2.1/css/all.min.css" rel="stylesheet">
  
  
  
  <script src="https://shroot.dev/js/jQuery.min.js" async="async"></script>
  <script src="https://shroot.dev/js/lodash.js" async="async"></script>
  <script src="https://shroot.dev/js/baidu.js" async="async"></script>
  
  <link rel="stylesheet" href="https://shroot.dev/css/main.css">
  
</head>
<body>
  <div class="nav">
  <div class="logoBox">
    <a href="/posts"><img src="/img/logo.png" alt="" class="logo"></a>
  </div>
  
  <ul>
    
    
    <li><a class="linkBox" href="/">欢迎页</a></li>
    
    <li><a class="linkBox" href="/posts">文章</a></li>
    
    <li><a class="linkBox" href="/about">关于我</a></li>
    
    <li><a class="linkBox" href="/tags">分类</a></li>
    
    <li><a class="linkBox" href="/links">友链</a></li>
    
  </ul>
</div>
<div class="header">
  <div class="subTitle">
    
    芝灵生于幽谷,不以无人而不芳
    
  </div>
  <div class="socials">
    <div class="socialLinks">
      
      <a href="mailto:917885215@qq.com" target="_blank"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a>
      
      <a href="https://github.com/Yazzyk" target="_blank"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
      
      <a href="#ZgotmplZ" target="_blank"><i class="fa-brands fa-qq" aria-hidden="true"></i></a>
      
      <a href="https://space.bilibili.com/10061915" target="_blank"><i class="fa-solid fa-tv" aria-hidden="true"></i></a>
      
    </div>
  </div>
</div>
  <div class="main">
    <div class="postContent">
      <h1>微信开发 - 环境搭建</h1>
      <small><i class="fa fa-clock-o" aria-hidden="true"></i>2019-12-25
        Yazzyk</small>
      <h2 id="环境搭建">环境搭建</h2>
<p>前往<a href="http://www.ngrok.cc">ngrok</a>下载指定客户端到本地</p>
<p>注册并登陆,开通一个隧道</p>
<p><!-- raw HTML omitted --><img src="https://img.css0209.cn/wechat/wechat01.png" alt="">
<!-- raw HTML omitted --><br>
到隧道管理可编辑自定义域名,复制隧道id</p>
<p>通过客户端启动隧道即可,以MacOS为例,在下载的客户端目录下,终端输入</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./sunny clientid 隧道id
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><a href="http://ngrok.cc/_book/start/ngrok_linux.html">文档</a></p>
</blockquote>
<p>输入后<code>status</code>显示为<code>online</code>即可通过域名访问到本地对应端口</p>
<h2 id="使用springboot开始搭建后端">使用SpringBoot开始搭建后端</h2>
<p>这里因为公司用的<code>Gradle</code>,为了学习,我也使用的<code>Gradle</code></p>
<p>使用到的技术:</p>
<ul>
<li>Spring WebFlux</li>
<li>Lombok</li>
<li>hutool</li>
<li>通用mapper</li>
<li>mapper自动生成器</li>
</ul>
<p><code>build.gradle</code>文件:</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">99
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">plugins {
    id &#39;org.springframework.boot&#39; version &#39;2.2.2.RELEASE&#39;
    id &#39;io.spring.dependency-management&#39; version &#39;1.0.8.RELEASE&#39;
    id &#39;java&#39;
}

group = &#39;cn.css0209&#39;
version = &#39;0.0.1-SNAPSHOT&#39;
sourceCompatibility = &#39;1.8&#39;

configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
    compileOnly {
        extendsFrom annotationProcessor
    }
    mybatisGenerator
}

repositories {
    mavenCentral()
}

dependencies {
    implementation &#39;org.springframework.boot:spring-boot-starter-jdbc&#39;
    implementation &#39;org.springframework.boot:spring-boot-starter-webflux&#39;
    implementation &#39;org.mybatis.spring.boot:mybatis-spring-boot-starter:2.1.1&#39;
    compileOnly &#39;org.projectlombok:lombok&#39;
    developmentOnly &#39;org.springframework.boot:spring-boot-devtools&#39;
    compile &#39;mysql:mysql-connector-java&#39;
    annotationProcessor &#39;org.projectlombok:lombok&#39;
    testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;) {
        exclude group: &#39;org.junit.vintage&#39;, module: &#39;junit-vintage-engine&#39;
    }
    testImplementation &#39;io.projectreactor:reactor-test&#39;
    compile &#39;cn.hutool:hutool-all:5.0.7&#39;
    // https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-configuration-processor
    annotationProcessor &#34;org.springframework.boot:spring-boot-configuration-processor&#34;
    compile &#39;org.mybatis.generator:mybatis-generator-core:1.3.6&#39;
    compile &#39;tk.mybatis:mapper:4.0.0&#39;
    // https://mvnrepository.com/artifact/tk.mybatis/mapper-core
    compile group: &#39;tk.mybatis&#39;, name: &#39;mapper-core&#39;, version: &#39;1.1.5&#39;
    // https://mvnrepository.com/artifact/tk.mybatis/mapper-weekend
    compile group: &#39;tk.mybatis&#39;, name: &#39;mapper-weekend&#39;, version: &#39;1.1.5&#39;
    compile &#39;cn.hutool:hutool-all:5.0.7&#39;
    mybatisGenerator &#39;org.mybatis.generator:mybatis-generator-core:1.3.6&#39;
    mybatisGenerator &#39;mysql:mysql-connector-java&#39;
    mybatisGenerator &#39;tk.mybatis:mapper:4.0.0&#39;
}


test {
    useJUnitPlatform()
}

def getDbProperties = {
    def properties = new Properties()
    file(&#34;src/main/resources/conf/jdbc.properties&#34;).withInputStream { inputStream -&gt;
        properties.load(inputStream)
    }
    properties
}

task mybatisGenerate {
    def properties = getDbProperties()
    ant.properties[&#39;targetProject&#39;] = projectDir.path
    ant.properties[&#39;driverClass&#39;] = properties.getProperty(&#34;jdbc.driverClassName&#34;)
    ant.properties[&#39;connectionURL&#39;] = properties.getProperty(&#34;jdbc.url&#34;)
    ant.properties[&#39;userId&#39;] = properties.getProperty(&#34;jdbc.username&#34;)
    ant.properties[&#39;password&#39;] = properties.getProperty(&#34;jdbc.password&#34;)
    ant.properties[&#39;src_main_java&#39;] = sourceSets.main.java.srcDirs[0].path
    ant.properties[&#39;src_main_resources&#39;] = sourceSets.main.resources.srcDirs[0].path
    ant.properties[&#39;modelPackage&#39;] = properties.getProperty(&#34;package.model&#34;)
    ant.properties[&#39;mapperPackage&#39;] = properties.getProperty(&#34;package.mapper&#34;)
    ant.properties[&#39;sqlMapperPackage&#39;] = properties.getProperty(&#34;package.xml&#34;)
    ant.taskdef(
            name: &#39;mbgenerator&#39;,
            classname: &#39;org.mybatis.generator.ant.GeneratorAntTask&#39;,
            classpath: configurations.mybatisGenerator.asPath
    )
    ant.mbgenerator(overwrite: true,
            configfile: &#39;src/main/resources/conf/generator.xml&#39;, verbose: true) {
        propertyset {
            propertyref(name: &#39;targetProject&#39;)
            propertyref(name: &#39;userId&#39;)
            propertyref(name: &#39;driverClass&#39;)
            propertyref(name: &#39;connectionURL&#39;)
            propertyref(name: &#39;password&#39;)
            propertyref(name: &#39;src_main_java&#39;)
            propertyref(name: &#39;src_main_resources&#39;)
            propertyref(name: &#39;modelPackage&#39;)
            propertyref(name: &#39;mapperPackage&#39;)
            propertyref(name: &#39;sqlMapperPackage&#39;)
        }
    }
}

</code></pre></td></tr></table>
</div>
</div><p>在<code>resource</code>文件下创建<code>conf</code>文件夹,在文件夹下创建<code>generator.xml</code>和<code>jdbc.properties</code>两个文件</p>
<p>文件内容如下:</p>
<p><code>generator.xml</code>:</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;!DOCTYPE generatorConfiguration
        PUBLIC &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34;
        &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt;

&lt;!--suppress MybatisGenerateCustomPluginInspection --&gt;
&lt;generatorConfiguration&gt;
    &lt;context id=&#34;Mysql&#34; targetRuntime=&#34;MyBatis3Simple&#34; defaultModelType=&#34;flat&#34;&gt;
        &lt;property name=&#34;javaFileEncoding&#34; value=&#34;UTF-8&#34;/&gt;
        &lt;property name=&#34;useMapperCommentGenerator&#34; value=&#34;false&#34;/&gt;

        &lt;plugin type=&#34;tk.mybatis.mapper.generator.MapperPlugin&#34;&gt;
            &lt;property name=&#34;mappers&#34; value=&#34;tk.mybatis.mapper.common.Mapper&#34;/&gt;
            &lt;property name=&#34;caseSensitive&#34; value=&#34;true&#34;/&gt;
            &lt;property name=&#34;forceAnnotation&#34; value=&#34;true&#34;/&gt;
            &lt;property name=&#34;beginningDelimiter&#34; value=&#34;`&#34;/&gt;
            &lt;property name=&#34;endingDelimiter&#34; value=&#34;`&#34;/&gt;
        &lt;/plugin&gt;

        &lt;jdbcConnection driverClass=&#34;${driverClass}&#34;
                        connectionURL=&#34;${connectionURL}&#34;
                        userId=&#34;${userId}&#34;
                        password=&#34;${password}&#34;&gt;
        &lt;/jdbcConnection&gt;

        &lt;!--MyBatis 生成器只需要生成 Model--&gt;
        &lt;javaModelGenerator targetPackage=&#34;${modelPackage}&#34;
                            targetProject=&#34;${src_main_java}&#34;&gt;
            &lt;property name=&#34;enableSubPackages&#34; value=&#34;true&#34;/&gt;
            &lt;property name=&#34;trimStrings&#34; value=&#34;true&#34;/&gt;
        &lt;/javaModelGenerator&gt;

        &lt;sqlMapGenerator targetPackage=&#34;${sqlMapperPackage}&#34;
                         targetProject=&#34;${src_main_resources}&#34;&gt;
            &lt;property name=&#34;enableSubPackages&#34; value=&#34;true&#34;/&gt;
        &lt;/sqlMapGenerator&gt;

        &lt;javaClientGenerator targetPackage=&#34;${mapperPackage}&#34;
                             targetProject=&#34;${src_main_java}&#34; type=&#34;XMLMAPPER&#34;&gt;
            &lt;property name=&#34;enableSubPackages&#34; value=&#34;true&#34;/&gt;
        &lt;/javaClientGenerator&gt;
&lt;!--        根据自己需求修改 --&gt;
        &lt;table tableName=&#34;表名&#34; domainObjectName=&#34;实体类名&#34;
               enableCountByExample=&#34;false&#34; enableUpdateByExample=&#34;false&#34;
               enableDeleteByExample=&#34;false&#34; enableSelectByExample=&#34;false&#34;
               selectByExampleQueryId=&#34;false&#34;&gt;
            &lt;generatedKey column=&#34;主键名&#34; sqlStatement=&#34;Mysql&#34; identity=&#34;true&#34;/&gt;
        &lt;/table&gt;
    &lt;/context&gt;
&lt;/generatorConfiguration&gt;
</code></pre></td></tr></table>
</div>
</div><p>生成器在默认情况下会生成一个Example类，使用</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">enableCountByExample=&#34;false&#34; enableUpdateByExample=&#34;false&#34;
enableDeleteByExample=&#34;false&#34; enableSelectByExample=&#34;false&#34;
selectByExampleQueryId=&#34;false&#34;
</code></pre></td></tr></table>
</div>
</div><p>可以避免生成</p>
<p><code>jdbc.properties</code>:</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># JDBC 驱动类名
jdbc.driverClassName=com.mysql.cj.jdbc.Driver
# JDBC URL: jdbc:mysql:// + 数据库主机地址 + 端口号 + 数据库名
jdbc.url=
# JDBC 用户名及密码
jdbc.username=
jdbc.password=

# 生成实体类所在的包
package.model= cn.css0209.wechat.entity
# 生成 mapper 类所在的包
package.mapper= cn.css0209.wechat.mapper
# 生成 mapper xml 文件所在的包，默认存储在 resources 目录下
package.xml=mybatis
</code></pre></td></tr></table>
</div>
</div><p>重新加载<code>gradle</code>后,应该就会自动生成一个实体类,一个mapper接口,一个在resources下的xml文件。</p>
<p>最后在<code>application.java</code>中加入注解</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#e5c07b">@EnableWebFlux</span>
<span style="color:#e5c07b">@MapperScan</span><span style="color:#54b1c7">(</span><span style="color:#98c379">&#34;cn.css0209.wechat.mapper&#34;</span><span style="color:#54b1c7">)</span>
</code></pre></td></tr></table>
</div>
</div><p>这样自动生成器的搭建就完成了</p>
<h2 id="微信公众号接入">微信公众号接入</h2>
<p>前往<a href="https://mp.weixin.qq.com/">微信公众平台</a>,登陆后到<code>基本配置页面</code>-&gt;<code>服务器配置</code>-&gt;<code>修改配置</code>,在url填入之前ngrok的域名,随便输一个<code>token</code>随机生成一个<code>EncodingAESKey</code>,消息加密方式根据自身情况选择,我选安全模式这里先不提交,将页面保留,去完善java代码</p>
<p><code>application.properties</code>文件名改为<code>application.yml</code></p>
<p>文件内容如下:</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#76a9f9">wechat</span><span style="color:#abb2bf">:</span>
  <span style="color:#76a9f9">appid</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">微信公众号appid</span>
  <span style="color:#76a9f9">secret</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">AppSecret</span>
  <span style="color:#76a9f9">token</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">token</span>
  <span style="color:#76a9f9">aesKey</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">EncodingAESKey</span>

<span style="color:#76a9f9">server</span><span style="color:#abb2bf">:</span>
  <span style="color:#76a9f9">port</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">ngrok注册时的端口号</span>
  
<span style="color:#76a9f9">spring</span><span style="color:#abb2bf">:</span>
  <span style="color:#76a9f9">datasource</span><span style="color:#abb2bf">:</span>
    <span style="color:#76a9f9">driver-class-name</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">com.mysql.cj.jdbc.Driver</span>
    <span style="color:#76a9f9">url</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">数据库地址</span>
    <span style="color:#76a9f9">username</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">数据库用户名</span>
    <span style="color:#76a9f9">password</span><span style="color:#abb2bf">:</span> <span style="color:#98c379">数据库密码</span>
</code></pre></td></tr></table>
</div>
</div><p>接下来先检查是否在<code>build.gradle</code>中引入了<code>spring-boot-configuration-processor</code></p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">// https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-configuration-processor
    annotationProcessor &#34;org.springframework.boot:spring-boot-configuration-processor&#34;
</code></pre></td></tr></table>
</div>
</div><p>创建一个<code>config</code>包,在包下创建<code>Wechat.java</code></p>
<p>这个使用了<code>lombok</code>,注意装插件</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#e5c07b">@Component</span>
<span style="color:#e5c07b">@Data</span>
<span style="color:#e5c07b">@ConfigurationProperties</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">prefix</span> <span style="color:#54b1c7">=</span> <span style="color:#98c379">&#34;wechat&#34;</span><span style="color:#54b1c7">)</span>
<span style="color:#76a9f9">public</span> <span style="color:#76a9f9">class</span> <span style="color:#ca72ff">WeChatConfig</span> <span style="color:#54b1c7">{</span>
    <span style="color:#76a9f9">private</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">appid</span><span style="color:#54b1c7">;</span>
    <span style="color:#76a9f9">private</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">secret</span><span style="color:#54b1c7">;</span>
    <span style="color:#76a9f9">private</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">token</span><span style="color:#54b1c7">;</span>
    <span style="color:#76a9f9">private</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">aesKey</span><span style="color:#54b1c7">;</span>
<span style="color:#54b1c7">}</span>
</code></pre></td></tr></table>
</div>
</div><p>创建<code>controller</code>包,创建<code>WeChatValidationController</code>控制器</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#e5c07b">@RestController</span>
<span style="color:#e5c07b">@RequestMapping</span><span style="color:#54b1c7">(</span><span style="color:#98c379">&#34;/&#34;</span><span style="color:#54b1c7">)</span>
<span style="color:#76a9f9">public</span> <span style="color:#76a9f9">class</span> <span style="color:#ca72ff">WeChatValidationController</span> <span style="color:#54b1c7">{</span>
    <span style="color:#e5c07b">@Autowired</span>
    <span style="color:#76a9f9">private</span> <span style="color:#aa89ea">WeChatValidationService</span> <span style="color:#aa89ea">servcie</span><span style="color:#54b1c7">;</span>

    <span style="color:#8a93a5;font-style:italic">/**
</span><span style="color:#8a93a5;font-style:italic">     * 微信接入验证
</span><span style="color:#8a93a5;font-style:italic">     *
</span><span style="color:#8a93a5;font-style:italic">     * @param signature  微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数。
</span><span style="color:#8a93a5;font-style:italic">     * @param timestamp 时间戳
</span><span style="color:#8a93a5;font-style:italic">     * @param nonce     随机数
</span><span style="color:#8a93a5;font-style:italic">     * @param echostr   随机字符串
</span><span style="color:#8a93a5;font-style:italic">     * @return
</span><span style="color:#8a93a5;font-style:italic">     */</span>
    <span style="color:#e5c07b">@GetMapping</span>
    <span style="color:#76a9f9">public</span> <span style="color:#aa89ea">Mono</span><span style="color:#54b1c7">&lt;</span><span style="color:#aa89ea">String</span><span style="color:#54b1c7">&gt;</span> <span style="color:#00b1f7">validation</span><span style="color:#54b1c7">(</span><span style="color:#e5c07b">@RequestParam</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">name</span> <span style="color:#54b1c7">=</span> <span style="color:#98c379">&#34;signature&#34;</span><span style="color:#54b1c7">)</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">signature</span><span style="color:#54b1c7">,</span>
                                   <span style="color:#e5c07b">@RequestParam</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">name</span> <span style="color:#54b1c7">=</span> <span style="color:#98c379">&#34;timestamp&#34;</span><span style="color:#54b1c7">)</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">timestamp</span><span style="color:#54b1c7">,</span>
                                   <span style="color:#e5c07b">@RequestParam</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">name</span> <span style="color:#54b1c7">=</span> <span style="color:#98c379">&#34;nonce&#34;</span><span style="color:#54b1c7">)</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">nonce</span><span style="color:#54b1c7">,</span>
                                   <span style="color:#e5c07b">@RequestParam</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">name</span> <span style="color:#54b1c7">=</span> <span style="color:#98c379">&#34;echostr&#34;</span><span style="color:#54b1c7">)</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">echostr</span><span style="color:#54b1c7">)</span> <span style="color:#54b1c7">{</span>
        <span style="color:#76a9f9">return</span> <span style="color:#aa89ea">servcie</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">validation</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">signature</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">timestamp</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">nonce</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">echostr</span><span style="color:#54b1c7">);</span>
    <span style="color:#54b1c7">}</span>
<span style="color:#54b1c7">}</span>
</code></pre></td></tr></table>
</div>
</div><p>创建<code>service</code>包,创建<code>WeChatValidationService</code>类</p>
<p>根据<a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html">官方文档</a></p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#e5c07b">@Service</span>
<span style="color:#e5c07b">@Slf4j</span>
<span style="color:#76a9f9">public</span> <span style="color:#76a9f9">class</span> <span style="color:#ca72ff">WeChatValidationService</span> <span style="color:#54b1c7">{</span>
    <span style="color:#76a9f9">private</span> <span style="color:#76a9f9">final</span> <span style="color:#aa89ea">WeChatConfig</span> <span style="color:#aa89ea">config</span><span style="color:#54b1c7">;</span>

    <span style="color:#76a9f9">public</span> <span style="color:#00b1f7">WeChatValidationService</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">WeChatConfig</span> <span style="color:#aa89ea">config</span><span style="color:#54b1c7">)</span> <span style="color:#54b1c7">{</span>
        <span style="color:#76a9f9">this</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">config</span> <span style="color:#54b1c7">=</span> <span style="color:#aa89ea">config</span><span style="color:#54b1c7">;</span>
    <span style="color:#54b1c7">}</span>

    <span style="color:#76a9f9">public</span> <span style="color:#aa89ea">Mono</span><span style="color:#54b1c7">&lt;</span><span style="color:#aa89ea">String</span><span style="color:#54b1c7">&gt;</span> <span style="color:#00b1f7">validation</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">String</span> <span style="color:#aa89ea">signture</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">timestamp</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">nonce</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">echostr</span><span style="color:#54b1c7">)</span> <span style="color:#54b1c7">{</span>
        <span style="color:#76a9f9">return</span> <span style="color:#aa89ea">Mono</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">just</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">1</span><span style="color:#54b1c7">).</span><span style="color:#cebc3a">map</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">n</span> <span style="color:#54b1c7">-&gt;</span> <span style="color:#54b1c7">{</span>
            <span style="color:#aa89ea">String</span><span style="color:#54b1c7">[]</span> <span style="color:#aa89ea">checkArr</span> <span style="color:#54b1c7">=</span> <span style="color:#76a9f9">new</span> <span style="color:#aa89ea">String</span><span style="color:#54b1c7">[]{</span><span style="color:#aa89ea">config</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">getToken</span><span style="color:#54b1c7">(),</span> <span style="color:#aa89ea">timestamp</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">nonce</span><span style="color:#54b1c7">};</span>
            <span style="color:#aa89ea">Arrays</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">sort</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">checkArr</span><span style="color:#54b1c7">);</span>
            <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">mySign</span> <span style="color:#54b1c7">=</span> <span style="color:#aa89ea">SecureUtil</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">sha1</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">checkArr</span><span style="color:#54b1c7">[</span><span style="color:#aa89ea">0</span><span style="color:#54b1c7">]</span> <span style="color:#54b1c7">+</span> <span style="color:#aa89ea">checkArr</span><span style="color:#54b1c7">[</span><span style="color:#aa89ea">1</span><span style="color:#54b1c7">]</span> <span style="color:#54b1c7">+</span> <span style="color:#aa89ea">checkArr</span><span style="color:#54b1c7">[</span><span style="color:#aa89ea">2</span><span style="color:#54b1c7">]);</span>
            <span style="color:#76a9f9">return</span> <span style="color:#aa89ea">signChect</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">signture</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">mySign</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">echostr</span><span style="color:#54b1c7">);</span>
        <span style="color:#54b1c7">}).</span><span style="color:#cebc3a">doOnError</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">Throwable</span><span style="color:#54b1c7">::</span><span style="color:#aa89ea">printStackTrace</span><span style="color:#54b1c7">);</span>
    <span style="color:#54b1c7">}</span>

    <span style="color:#76a9f9">private</span> <span style="color:#aa89ea">String</span> <span style="color:#00b1f7">signChect</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">String</span> <span style="color:#aa89ea">signture</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">mySign</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">String</span> <span style="color:#aa89ea">echostr</span><span style="color:#54b1c7">)</span> <span style="color:#54b1c7">{</span>
        <span style="color:#aa89ea">log</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">info</span><span style="color:#54b1c7">(</span><span style="color:#98c379">&#34;微信signture:{},我的sign:{}&#34;</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">signture</span><span style="color:#54b1c7">,</span> <span style="color:#aa89ea">mySign</span><span style="color:#54b1c7">);</span>
        <span style="color:#76a9f9">if</span> <span style="color:#54b1c7">(</span><span style="color:#aa89ea">signture</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">equals</span><span style="color:#54b1c7">(</span><span style="color:#aa89ea">mySign</span><span style="color:#54b1c7">))</span> <span style="color:#54b1c7">{</span>
            <span style="color:#aa89ea">log</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">info</span><span style="color:#54b1c7">(</span><span style="color:#98c379">&#34;接入成功&#34;</span><span style="color:#54b1c7">);</span>
            <span style="color:#76a9f9">return</span> <span style="color:#aa89ea">echostr</span><span style="color:#54b1c7">;</span>
        <span style="color:#54b1c7">}</span> <span style="color:#76a9f9">else</span> <span style="color:#54b1c7">{</span>
            <span style="color:#aa89ea">log</span><span style="color:#54b1c7">.</span><span style="color:#cebc3a">info</span><span style="color:#54b1c7">(</span><span style="color:#98c379">&#34;接入失败&#34;</span><span style="color:#54b1c7">);</span>
            <span style="color:#76a9f9">return</span> <span style="color:#98c379">&#34;接入失败&#34;</span><span style="color:#54b1c7">;</span>
        <span style="color:#54b1c7">}</span>
    <span style="color:#54b1c7">}</span>
<span style="color:#54b1c7">}</span>
</code></pre></td></tr></table>
</div>
</div><p>最后加上个骚气的<code>banner.txt</code></p>
<p>在<code>resource</code>下创建<code>banner.txt</code>文件</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">${AnsiColor.BLUE}
 _______            __            _______   __
/       \          /  |          /       \ /  |
$$$$$$$  | ______  $$ |  ______  $$$$$$$  |$$ | __    __   ______
$$ |__$$ |/      \ $$ | /      \ $$ |__$$ |$$ |/  |  /  | /      \
$$    $$/ $$$$$$  |$$ |/$$$$$$  |$$    $$&lt; $$ |$$ |  $$ |/$$$$$$  |
$$$$$$$/  /    $$ |$$ |$$    $$ |$$$$$$$  |$$ |$$ |  $$ |$$    $$ |
$$ |     /$$$$$$$ |$$ |$$$$$$$$/ $$ |__$$ |$$ |$$ \__$$ |$$$$$$$$/
$$ |     $$    $$ |$$ |$$       |$$    $$/ $$ |$$    $$/ $$       |
$$/       $$$$$$$/ $$/  $$$$$$$/ $$$$$$$/  $$/  $$$$$$/   $$$$$$$/

SpringBoot Version: ${spring-boot.version}

</code></pre></td></tr></table>
</div>
</div>
      <div class="postFooter">
        
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>Java
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>Wechat
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>ngrok
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>SpringBoot
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>WebFlux
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>MyBatis
        </small>
        
        
      </div>
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-link"><strong>本文链接：</strong> <a href="/posts/wechat01/" title="微信开发 - 环境搭建 "
              class="line">微信开发 - 环境搭建</a></li>
          <li class="post-copyright-license"><strong>版权声明：</strong> 本<span xmlns:dct="http://purl.org/dc/terms/"
              href="http://purl.org/dc/dcmitype/Text" rel="dct:type">作品</span>由<span
              xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Yazzyk</span>采用<a
              rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh">知识共享署名-非商业性使用 4.0
              国际许可协议</a>进行许可。<br />基于<a xmlns:dct="http://purl.org/dc/terms/" href="https://css0209.cn"
              rel="dct:source">Yazzyk&#39;s Blog</a>上的作品创作。转载请注明出处！</li>
        </ul>
      </div>
      
      
    </div>
  </div>
  <footer>
  <div class="leftBox">
    <span>Theme Designed by <a href="https://shroot.dev" target="_blank">Yazzyk</a></span><br />
    <span>Proudly published with <a href="https://gohugo.io" target="_blank">Hugo</a></span>
  </div>
  <div class="rightBox">
    <span>Copyright © 2020-2022.12 <a href="https://shroot.dev">Yazzyk</a> All Rights Reserved</span><br />
    
    
  </div>
</footer>
</body>

<script src="https://shroot.dev/js/list.js"></script>
<script src="https://shroot.dev/js/post.js"></script>