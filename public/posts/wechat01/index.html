<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PaleBlueYk&#39;s Blog</title>
  <meta name="author" content="PaleBlueYk" />
  
  <meta name="description" content="环境搭建 前往ngrok下载指定客户端到本地 注册并登陆,开通一个隧道 到隧道管理可编辑自定义域名,复制隧道id 通过客户端启动隧道即可,以MacOS为例,在下载的客户端目录下,终端输入 ./sunny clientid 隧道id 文档 输入后" />
  
  <meta name="keywords" content="">
  <meta name="baidu-site-verification" content="u4UUwskbhk" />
  <meta name="google-site-verification" content="kAjz9Ic_7Hir1rNUQtXSxTydJTryAv8JMelb2Qvnges" />
  <link rel="shortcut icon" href="https://css0209.cn/img/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://css0209.cn/css/white.css">
  <link rel="stylesheet" href="https://css0209.cn/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://css0209.cn/css/highlight.css">
  <script src="https://css0209.cn/js/heighlight.min.js"></script>
  
  
  
  <script src="https://css0209.cn/js/jQuery.min.js"></script>
  <script src="https://css0209.cn/js/lodash.js"></script>
  <script src="https://css0209.cn/js/baidu.js"></script>
  <link rel="stylesheet" href="https://css0209.cn/css/main.css">
</head>
<body>
  <div class="nav">
  <div class="logoBox">
    <a href="/posts"><img src="/img/logo.png" alt="" class="logo"></a>
  </div>
  <button class="bars" onclick="toggleMenus()"><i class="fa fa-bars" aria-hidden="true"></i></button>
  <ul>
    
    
    <li><a class="linkBox" href="/">Welcome</a></li>
    
    <li><a class="linkBox" href="/posts">Home</a></li>
    
    <li><a class="linkBox" href="/about">About</a></li>
    
    <li><a class="linkBox" href="/tags">Tags</a></li>
    
    <li><a class="linkBox" href="/links">Links</a></li>
    
  </ul>
</div>
<div class="header">
  <div class="subTitle">
    
    芝灵生于幽谷,不以无人而不芳
    
  </div>
  <div class="socials">
    <div class="socialLinks">
      
      
      <a href="mailto:blankyk@css0209.cn" title="envelope-o" target="_blank"><i class="fa fa-envelope-o"
          aria-hidden="true"></i></a>
      
      
      
      <a href="https://github.com/paleBlueYk" title="github-alt" target="_blank"><i class="fa fa-github-alt"
          aria-hidden="true"></i></a>
      
      
      
      <a href="tencent://Message/?Uin=917885215&amp;amp;websiteName=q-zone.qq.com&amp;amp;Menu=yes" title="qq" target="_blank"><i class="fa fa-qq"
          aria-hidden="true"></i></a>
      
      
      
      <a href="https://space.bilibili.com/10061915" title="television" target="_blank"><i class="fa fa-television"
          aria-hidden="true"></i></a>
      
      
    </div>
  </div>
</div>
  <div class="main">
    <div class="postContent">
      <h1>微信开发 - 环境搭建</h1>
      <small><i class="fa fa-clock-o" aria-hidden="true"></i>2019-12-25
        PaleBlueYk</small>
      <h2 id="环境搭建">环境搭建</h2>
<p>前往<a href="http://www.ngrok.cc">ngrok</a>下载指定客户端到本地</p>
<p>注册并登陆,开通一个隧道</p>
<p><!-- raw HTML omitted --><img src="https://img.css0209.cn/wechat/wechat01.png" alt="">
<!-- raw HTML omitted --><br>
到隧道管理可编辑自定义域名,复制隧道id</p>
<p>通过客户端启动隧道即可,以MacOS为例,在下载的客户端目录下,终端输入</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./sunny clientid 隧道id
</code></pre></div><blockquote>
<p><a href="http://ngrok.cc/_book/start/ngrok_linux.html">文档</a></p>
</blockquote>
<p>输入后<code>status</code>显示为<code>online</code>即可通过域名访问到本地对应端口</p>
<h2 id="使用springboot开始搭建后端">使用SpringBoot开始搭建后端</h2>
<p>这里因为公司用的<code>Gradle</code>,为了学习,我也使用的<code>Gradle</code></p>
<p>使用到的技术:</p>
<ul>
<li>Spring WebFlux</li>
<li>Lombok</li>
<li>hutool</li>
<li>通用mapper</li>
<li>mapper自动生成器</li>
</ul>
<p><code>build.gradle</code>文件:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">plugins {
    id &#39;org.springframework.boot&#39; version &#39;2.2.2.RELEASE&#39;
    id &#39;io.spring.dependency-management&#39; version &#39;1.0.8.RELEASE&#39;
    id &#39;java&#39;
}

group = &#39;cn.css0209&#39;
version = &#39;0.0.1-SNAPSHOT&#39;
sourceCompatibility = &#39;1.8&#39;

configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
    compileOnly {
        extendsFrom annotationProcessor
    }
    mybatisGenerator
}

repositories {
    mavenCentral()
}

dependencies {
    implementation &#39;org.springframework.boot:spring-boot-starter-jdbc&#39;
    implementation &#39;org.springframework.boot:spring-boot-starter-webflux&#39;
    implementation &#39;org.mybatis.spring.boot:mybatis-spring-boot-starter:2.1.1&#39;
    compileOnly &#39;org.projectlombok:lombok&#39;
    developmentOnly &#39;org.springframework.boot:spring-boot-devtools&#39;
    compile &#39;mysql:mysql-connector-java&#39;
    annotationProcessor &#39;org.projectlombok:lombok&#39;
    testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;) {
        exclude group: &#39;org.junit.vintage&#39;, module: &#39;junit-vintage-engine&#39;
    }
    testImplementation &#39;io.projectreactor:reactor-test&#39;
    compile &#39;cn.hutool:hutool-all:5.0.7&#39;
    // https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-configuration-processor
    annotationProcessor &#34;org.springframework.boot:spring-boot-configuration-processor&#34;
    compile &#39;org.mybatis.generator:mybatis-generator-core:1.3.6&#39;
    compile &#39;tk.mybatis:mapper:4.0.0&#39;
    // https://mvnrepository.com/artifact/tk.mybatis/mapper-core
    compile group: &#39;tk.mybatis&#39;, name: &#39;mapper-core&#39;, version: &#39;1.1.5&#39;
    // https://mvnrepository.com/artifact/tk.mybatis/mapper-weekend
    compile group: &#39;tk.mybatis&#39;, name: &#39;mapper-weekend&#39;, version: &#39;1.1.5&#39;
    compile &#39;cn.hutool:hutool-all:5.0.7&#39;
    mybatisGenerator &#39;org.mybatis.generator:mybatis-generator-core:1.3.6&#39;
    mybatisGenerator &#39;mysql:mysql-connector-java&#39;
    mybatisGenerator &#39;tk.mybatis:mapper:4.0.0&#39;
}


test {
    useJUnitPlatform()
}

def getDbProperties = {
    def properties = new Properties()
    file(&#34;src/main/resources/conf/jdbc.properties&#34;).withInputStream { inputStream -&gt;
        properties.load(inputStream)
    }
    properties
}

task mybatisGenerate {
    def properties = getDbProperties()
    ant.properties[&#39;targetProject&#39;] = projectDir.path
    ant.properties[&#39;driverClass&#39;] = properties.getProperty(&#34;jdbc.driverClassName&#34;)
    ant.properties[&#39;connectionURL&#39;] = properties.getProperty(&#34;jdbc.url&#34;)
    ant.properties[&#39;userId&#39;] = properties.getProperty(&#34;jdbc.username&#34;)
    ant.properties[&#39;password&#39;] = properties.getProperty(&#34;jdbc.password&#34;)
    ant.properties[&#39;src_main_java&#39;] = sourceSets.main.java.srcDirs[0].path
    ant.properties[&#39;src_main_resources&#39;] = sourceSets.main.resources.srcDirs[0].path
    ant.properties[&#39;modelPackage&#39;] = properties.getProperty(&#34;package.model&#34;)
    ant.properties[&#39;mapperPackage&#39;] = properties.getProperty(&#34;package.mapper&#34;)
    ant.properties[&#39;sqlMapperPackage&#39;] = properties.getProperty(&#34;package.xml&#34;)
    ant.taskdef(
            name: &#39;mbgenerator&#39;,
            classname: &#39;org.mybatis.generator.ant.GeneratorAntTask&#39;,
            classpath: configurations.mybatisGenerator.asPath
    )
    ant.mbgenerator(overwrite: true,
            configfile: &#39;src/main/resources/conf/generator.xml&#39;, verbose: true) {
        propertyset {
            propertyref(name: &#39;targetProject&#39;)
            propertyref(name: &#39;userId&#39;)
            propertyref(name: &#39;driverClass&#39;)
            propertyref(name: &#39;connectionURL&#39;)
            propertyref(name: &#39;password&#39;)
            propertyref(name: &#39;src_main_java&#39;)
            propertyref(name: &#39;src_main_resources&#39;)
            propertyref(name: &#39;modelPackage&#39;)
            propertyref(name: &#39;mapperPackage&#39;)
            propertyref(name: &#39;sqlMapperPackage&#39;)
        }
    }
}

</code></pre></div><p>在<code>resource</code>文件下创建<code>conf</code>文件夹,在文件夹下创建<code>generator.xml</code>和<code>jdbc.properties</code>两个文件</p>
<p>文件内容如下:</p>
<p><code>generator.xml</code>:</p>
<pre><code>&lt;!DOCTYPE generatorConfiguration
        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;

&lt;!--suppress MybatisGenerateCustomPluginInspection --&gt;
&lt;generatorConfiguration&gt;
    &lt;context id=&quot;Mysql&quot; targetRuntime=&quot;MyBatis3Simple&quot; defaultModelType=&quot;flat&quot;&gt;
        &lt;property name=&quot;javaFileEncoding&quot; value=&quot;UTF-8&quot;/&gt;
        &lt;property name=&quot;useMapperCommentGenerator&quot; value=&quot;false&quot;/&gt;

        &lt;plugin type=&quot;tk.mybatis.mapper.generator.MapperPlugin&quot;&gt;
            &lt;property name=&quot;mappers&quot; value=&quot;tk.mybatis.mapper.common.Mapper&quot;/&gt;
            &lt;property name=&quot;caseSensitive&quot; value=&quot;true&quot;/&gt;
            &lt;property name=&quot;forceAnnotation&quot; value=&quot;true&quot;/&gt;
            &lt;property name=&quot;beginningDelimiter&quot; value=&quot;`&quot;/&gt;
            &lt;property name=&quot;endingDelimiter&quot; value=&quot;`&quot;/&gt;
        &lt;/plugin&gt;

        &lt;jdbcConnection driverClass=&quot;${driverClass}&quot;
                        connectionURL=&quot;${connectionURL}&quot;
                        userId=&quot;${userId}&quot;
                        password=&quot;${password}&quot;&gt;
        &lt;/jdbcConnection&gt;

        &lt;!--MyBatis 生成器只需要生成 Model--&gt;
        &lt;javaModelGenerator targetPackage=&quot;${modelPackage}&quot;
                            targetProject=&quot;${src_main_java}&quot;&gt;
            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;
            &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt;
        &lt;/javaModelGenerator&gt;

        &lt;sqlMapGenerator targetPackage=&quot;${sqlMapperPackage}&quot;
                         targetProject=&quot;${src_main_resources}&quot;&gt;
            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;
        &lt;/sqlMapGenerator&gt;

        &lt;javaClientGenerator targetPackage=&quot;${mapperPackage}&quot;
                             targetProject=&quot;${src_main_java}&quot; type=&quot;XMLMAPPER&quot;&gt;
            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;
        &lt;/javaClientGenerator&gt;
&lt;!--        根据自己需求修改 --&gt;
        &lt;table tableName=&quot;表名&quot; domainObjectName=&quot;实体类名&quot;
               enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;
               enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
               selectByExampleQueryId=&quot;false&quot;&gt;
            &lt;generatedKey column=&quot;主键名&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot;/&gt;
        &lt;/table&gt;
    &lt;/context&gt;
&lt;/generatorConfiguration&gt;
</code></pre><p>生成器在默认情况下会生成一个Example类，使用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">enableCountByExample=&#34;false&#34; enableUpdateByExample=&#34;false&#34;
enableDeleteByExample=&#34;false&#34; enableSelectByExample=&#34;false&#34;
selectByExampleQueryId=&#34;false&#34;
</code></pre></div><p>可以避免生成</p>
<p><code>jdbc.properties</code>:</p>
<pre><code class="language-properties" data-lang="properties"># JDBC 驱动类名
jdbc.driverClassName=com.mysql.cj.jdbc.Driver
# JDBC URL: jdbc:mysql:// + 数据库主机地址 + 端口号 + 数据库名
jdbc.url=
# JDBC 用户名及密码
jdbc.username=
jdbc.password=

# 生成实体类所在的包
package.model= cn.css0209.wechat.entity
# 生成 mapper 类所在的包
package.mapper= cn.css0209.wechat.mapper
# 生成 mapper xml 文件所在的包，默认存储在 resources 目录下
package.xml=mybatis
</code></pre><p>重新加载<code>gradle</code>后,应该就会自动生成一个实体类,一个mapper接口,一个在resources下的xml文件。</p>
<p>最后在<code>application.java</code>中加入注解</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@EnableWebFlux</span>
<span style="color:#a6e22e">@MapperScan</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cn.css0209.wechat.mapper&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><p>这样自动生成器的搭建就完成了</p>
<h2 id="微信公众号接入">微信公众号接入</h2>
<p>前往<a href="https://mp.weixin.qq.com/">微信公众平台</a>,登陆后到<code>基本配置页面</code>-&gt;<code>服务器配置</code>-&gt;<code>修改配置</code>,在url填入之前ngrok的域名,随便输一个<code>token</code>随机生成一个<code>EncodingAESKey</code>,消息加密方式根据自身情况选择,我选安全模式这里先不提交,将页面保留,去完善java代码</p>
<p><code>application.properties</code>文件名改为<code>application.yml</code></p>
<p>文件内容如下:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">wechat</span>:
  <span style="color:#66d9ef">appid</span>: 微信公众号appid
  <span style="color:#66d9ef">secret</span>: AppSecret
  <span style="color:#66d9ef">token</span>: token
  <span style="color:#66d9ef">aesKey</span>: EncodingAESKey

<span style="color:#66d9ef">server</span>:
  <span style="color:#66d9ef">port</span>: ngrok注册时的端口号
  
<span style="color:#66d9ef">spring</span>:
  <span style="color:#66d9ef">datasource</span>:
    <span style="color:#66d9ef">driver-class-name</span>: com.mysql.cj.jdbc.Driver
    <span style="color:#66d9ef">url</span>: 数据库地址
    <span style="color:#66d9ef">username</span>: 数据库用户名
    <span style="color:#66d9ef">password</span>: 数据库密码
</code></pre></div><p>接下来先检查是否在<code>build.gradle</code>中引入了<code>spring-boot-configuration-processor</code></p>
<pre><code>// https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-configuration-processor
    annotationProcessor &quot;org.springframework.boot:spring-boot-configuration-processor&quot;
</code></pre><p>创建一个<code>config</code>包,在包下创建<code>Wechat.java</code></p>
<p>这个使用了<code>lombok</code>,注意装插件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Component</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@ConfigurationProperties</span><span style="color:#f92672">(</span>prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wechat&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WeChatConfig</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> String appid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String secret<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String token<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String aesKey<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>创建<code>controller</code>包,创建<code>WeChatValidationController</code>控制器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestController</span>
<span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WeChatValidationController</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">private</span> WeChatValidationService servcie<span style="color:#f92672">;</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 微信接入验证
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param signature  微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数。
</span><span style="color:#75715e">     * @param timestamp 时间戳
</span><span style="color:#75715e">     * @param nonce     随机数
</span><span style="color:#75715e">     * @param echostr   随机字符串
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@GetMapping</span>
    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">validation</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;signature&#34;</span><span style="color:#f92672">)</span> String signature<span style="color:#f92672">,</span>
                                   <span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;timestamp&#34;</span><span style="color:#f92672">)</span> String timestamp<span style="color:#f92672">,</span>
                                   <span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nonce&#34;</span><span style="color:#f92672">)</span> String nonce<span style="color:#f92672">,</span>
                                   <span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echostr&#34;</span><span style="color:#f92672">)</span> String echostr<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> servcie<span style="color:#f92672">.</span><span style="color:#a6e22e">validation</span><span style="color:#f92672">(</span>signature<span style="color:#f92672">,</span> timestamp<span style="color:#f92672">,</span> nonce<span style="color:#f92672">,</span> echostr<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>创建<code>service</code>包,创建<code>WeChatValidationService</code>类</p>
<p>根据<a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html">官方文档</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Service</span>
<span style="color:#a6e22e">@Slf4j</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WeChatValidationService</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> WeChatConfig config<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">WeChatValidationService</span><span style="color:#f92672">(</span>WeChatConfig config<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> config<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">validation</span><span style="color:#f92672">(</span>String signture<span style="color:#f92672">,</span> String timestamp<span style="color:#f92672">,</span> String nonce<span style="color:#f92672">,</span> String echostr<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> Mono<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>n <span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
            String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> checkArr <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">[</span><span style="color:#f92672">]</span><span style="color:#f92672">{</span>config<span style="color:#f92672">.</span><span style="color:#a6e22e">getToken</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> timestamp<span style="color:#f92672">,</span> nonce<span style="color:#f92672">}</span><span style="color:#f92672">;</span>
            Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>checkArr<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            String mySign <span style="color:#f92672">=</span> SecureUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">sha1</span><span style="color:#f92672">(</span>checkArr<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> checkArr<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> checkArr<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span> signChect<span style="color:#f92672">(</span>signture<span style="color:#f92672">,</span> mySign<span style="color:#f92672">,</span> echostr<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doOnError</span><span style="color:#f92672">(</span>Throwable<span style="color:#f92672">:</span><span style="color:#f92672">:</span>printStackTrace<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">signChect</span><span style="color:#f92672">(</span>String signture<span style="color:#f92672">,</span> String mySign<span style="color:#f92672">,</span> String echostr<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;微信signture:{},我的sign:{}&#34;</span><span style="color:#f92672">,</span> signture<span style="color:#f92672">,</span> mySign<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>signture<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>mySign<span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;接入成功&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span> echostr<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;接入失败&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;接入失败&#34;</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>最后加上个骚气的<code>banner.txt</code></p>
<p>在<code>resource</code>下创建<code>banner.txt</code>文件</p>
<pre><code>${AnsiColor.BLUE}
 _______            __            _______   __
/       \          /  |          /       \ /  |
$$$$$$$  | ______  $$ |  ______  $$$$$$$  |$$ | __    __   ______
$$ |__$$ |/      \ $$ | /      \ $$ |__$$ |$$ |/  |  /  | /      \
$$    $$/ $$$$$$  |$$ |/$$$$$$  |$$    $$&lt; $$ |$$ |  $$ |/$$$$$$  |
$$$$$$$/  /    $$ |$$ |$$    $$ |$$$$$$$  |$$ |$$ |  $$ |$$    $$ |
$$ |     /$$$$$$$ |$$ |$$$$$$$$/ $$ |__$$ |$$ |$$ \__$$ |$$$$$$$$/
$$ |     $$    $$ |$$ |$$       |$$    $$/ $$ |$$    $$/ $$       |
$$/       $$$$$$$/ $$/  $$$$$$$/ $$$$$$$/  $$/  $$$$$$/   $$$$$$$/

SpringBoot Version: ${spring-boot.version}

</code></pre>
      <div class="postFooter">
        
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>Java
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>Wechat
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>ngrok
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>SpringBoot
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>WebFlux
        </small>
        
        <small class="tags">
          <i class="fa fa-tag" aria-hidden="true"></i>MyBatis
        </small>
        
        
      </div>
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-link"><strong>本文链接：</strong> <a href="/posts/wechat01/" title="微信开发 - 环境搭建 "
              class="line">微信开发 - 环境搭建</a></li>
          <li class="post-copyright-license"><strong>版权声明：</strong> 本<span xmlns:dct="http://purl.org/dc/terms/"
              href="http://purl.org/dc/dcmitype/Text" rel="dct:type">作品</span>由<span
              xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">PaleBlueYk</span>采用<a
              rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh">知识共享署名-非商业性使用 4.0
              国际许可协议</a>进行许可。<br />基于<a xmlns:dct="http://purl.org/dc/terms/" href="https://css0209.cn"
              rel="dct:source">PaleBlueYk&#39;s Blog</a>上的作品创作。转载请注明出处！</li>
        </ul>
      </div>
      
      
    </div>
  </div>
  <footer>
  <div class="leftBox">
    <span>Theme Designed by <a href="https://css0209.cn" target="_blank">PaleBlueYk</a></span><br />
    <span>Proudly published with <a href="https://gohugo.io" target="_blank">Hugo</a></span>
  </div>
  <div class="rightBox">
    <span>Copyright © 2020-2020.10 <a href="https://css0209.cn">PaleBlueYk</a> All Rights Reserved</span><br />
    
    <span><a href="http://www.beian.miit.gov.cn/" target="_blank">蜀ICP备17038940号-2</a></span><br />
    
    
    <span>
      <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51010702001557" target="_blank">
        <img class="beian" src="https://css0209.cn/img/beian.png" alt="">川公网安备 51010702001557号
      </a>
    </span>
    
  </div>
</footer>
</body>

<script src="https://css0209.cn/js/list.js"></script>
<script src="https://css0209.cn/js/post.js"></script>